(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21abe6"],{bd8f:function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e._self._c;return t("fragment",[e.loading||e.checkingToken?t("LoadingOverlay"):e._e(),t("MainSettingsForm",{attrs:{loading:e.loading,checkingToken:e.checkingToken,localesList:e.localesList,accountGroupsList:e.probonusInfo.account_groups,botUsername:e.botUsername,probonusSexRequired:e.probonusInfo.probonus_application_settings.requireSex,tokenIsValid:e.tokenIsValid,snackbarMessage:e.snackbarMessage},on:{onSave:e.save,onTokenCheck:e.checkToken,onTokenChange:function(t){e.tokenIsValid=!1}},model:{value:e.localConfig,callback:function(t){e.localConfig=t},expression:"localConfig"}})],1)},o=[],a=s("c7eb"),l=s("1da1"),r=(s("b64b"),s("e9c4"),s("3f08")),i=s("8336"),c=s("b0af"),u=s("99d9"),d=s("62ad"),g=s("4bd4"),m=s("132d"),b=s("0fd9"),p=s("3129"),_=s("2db4"),f=s("2fa4"),h=(s("ac1f"),s("466d"),s("caad"),s("2532"),s("14d9"),s("99af"),s("a434"),function(){var e=this,t=e._self._c;return t(c["a"],[t(u["c"],[t("T",[e._v("Настройки / Основные")])],1),e.loading?t(p["a"],{attrs:{type:"list-item-three-line"}}):t(g["a"],{on:{submit:function(t){return t.preventDefault(),e.$emit("onSave")}},model:{value:e.formIsValid,callback:function(t){e.formIsValid=t},expression:"formIsValid"}},[t(u["b"],[t("ExpansionPanels",{model:{value:e.openedPanels,callback:function(t){e.openedPanels=t},expression:"openedPanels"}},[t("Panel",{attrs:{header:e.$t("Настройки локального сервера ProBonus Bot")}},[t(d["a"],{attrs:{cols:"12",md:"6"}},[t("SwitchField",{attrs:{label:e.$t("Слушать все адреса. Не изменять параметр без понимания его смысла"),hint:e.$t("Подключение к серверу возможно по любому адресу")},model:{value:e.listenAll,callback:function(t){e.listenAll=t},expression:"listenAll"}})],1),t(d["a"],{attrs:{cols:"12",md:"6"}},[t("TextField",{attrs:{label:e.$t("Прослушиваемый адрес"),hint:e.$t("Адрес, по которому доступно подключение к серверу"),disabled:e.listenAll,rules:[function(t){return!!t||e.$t("Это поле обязательно")},function(t){return!!t.match("^((25[0-5]|(2[0-4]|1\\d|[1-9]|)\\d)\\.?\\b){4}$")||e.$t("Адрес не валиден")}]},model:{value:e.model.server_settings.host,callback:function(t){e.$set(e.model.server_settings,"host",t)},expression:"model.server_settings.host"}})],1),t(d["a"],{attrs:{cols:"12",md:"6"}},[t("TextField",{attrs:{label:e.$t("Порт на котором работает сервер ProBonus Bot"),hint:e.$t("Порт, по которому доступно подключение к серверу"),rules:[function(t){return!!t||e.$t("Это поле обязательно")},function(t){return t=parseInt(t),t>=0&&t<=65535||e.$t("Доступны значения от 0 до 65535")}]},model:{value:e.model.server_settings.port,callback:function(t){e.$set(e.model.server_settings,"port",t)},expression:"model.server_settings.port"}})],1),t(d["a"],{attrs:{cols:"12",md:"6"}},[t("SelectField",{attrs:{label:e.$t("Язык"),hint:e.$t("Язык локализации программы"),items:e.localesList,rules:[function(t){return!!t||e.$t("Это поле обязательно")}]},model:{value:e.model.server_settings.language,callback:function(t){e.$set(e.model.server_settings,"language",t)},expression:"model.server_settings.language"}})],1)],1),t("Panel",{attrs:{header:e.$t("Настройки бота")}},[t(d["a"],{attrs:{cols:"12",md:"8"}},[t("TextField",{attrs:{hint:"".concat(e.$t("Токен бота, выданный при его создании в")," @BotFather"),rules:e.tokenIsValid?[]:[function(t){return!!t||e.$t("Это поле обязательно")},function(t){return t===e.$store.getters.config.bot_settings.token||e.$t("Токен не проверен")}]},on:{input:function(t){return e.$emit("onTokenChange")}},scopedSlots:e._u([{key:"label",fn:function(){return[t("T",[e._v("Токен, выданный")]),t("a",{attrs:{target:"_blank",rel:"noopener noreferrer",href:"https://t.me/BotFather"}},[e._v("@BotFather")])]},proxy:!0}]),model:{value:e.model.bot_settings.token,callback:function(t){e.$set(e.model.bot_settings,"token",t)},expression:"model.bot_settings.token"}})],1),t(d["a"],{attrs:{cols:"12",md:"4"}},[t(i["a"],{attrs:{color:"primary",disabled:!e.model.bot_settings.token,loading:e.checkingToken},on:{click:function(t){return e.$emit("onTokenCheck")}}},[t("T",[e._v("Проверить токен")])],1)],1),t(d["a"],{attrs:{cols:"12"}},[t("TextField",{attrs:{label:e.$t("Сообщений из рассылок в секунду"),hint:e.$t("Кол-во сообщений из рассылок, которое бот может отправлять в секунду"),rules:[function(t){return!!t||e.$t("Это поле обязательно")},function(t){return parseInt(t)<=20&&parseInt(t)>=5||e.$t("Кол-во запросов должно быть от 5 до 20")}]},model:{value:e.model.bot_settings.mails_per_sec,callback:function(t){e.$set(e.model.bot_settings,"mails_per_sec",t)},expression:"model.bot_settings.mails_per_sec"}})],1),t(d["a"],{attrs:{cols:"12",md:"5"}},[t("SwitchField",{attrs:{label:e.$t("Разрешить гостям оставлять отзывы в боте"),hint:e.$t("При использовании этой опции гость сможет написать отзыв о работе заведения, который будет передан на рассмотрение администрации")},model:{value:e.model.bot_settings.allow_reviews,callback:function(t){e.$set(e.model.bot_settings,"allow_reviews",t)},expression:"model.bot_settings.allow_reviews"}})],1),t(d["a"],{attrs:{cols:"12",md:"7"}},[t("TextField",{attrs:{hint:e.$t("Идентификатор чата, в который будут отправляться отзывы гостей"),disabled:!e.model.bot_settings.allow_reviews,rules:e.model.bot_settings.allow_reviews?[function(t){return!!t||e.$t("Это поле обязательно")}]:[]},scopedSlots:e._u([{key:"label",fn:function(){return[t("T",[e._v("Идентификатор чата для отзывов. Дефис перед цифрами важен")])]},proxy:!0}]),model:{value:e.model.bot_settings.manage_chat,callback:function(t){e.$set(e.model.bot_settings,"manage_chat",t)},expression:"model.bot_settings.manage_chat"}})],1),t(d["a"],{attrs:{cols:"12"}},[t("SwitchField",{attrs:{label:e.$t("Разрешить регистрацию новых счетов через бота"),hint:e.$t("Можно ли регистрировать новые счета ProBonus через бота")},model:{value:e.model.bot_settings.register_user,callback:function(t){e.$set(e.model.bot_settings,"register_user",t)},expression:"model.bot_settings.register_user"}})],1),t(d["a"],{staticClass:"pl-7",attrs:{cols:"12"}},[t("SwitchField",{attrs:{label:e.$t("Запрашивать возраст при регистрации"),hint:e.$t("Нужно ли запрашивать возраст при регистрации нового счета ProBonus через бота"),disabled:!e.model.bot_settings.register_user},model:{value:e.model.bot_settings.need_birthday,callback:function(t){e.$set(e.model.bot_settings,"need_birthday",t)},expression:"model.bot_settings.need_birthday"}})],1),t(d["a"],{staticClass:"pl-7",attrs:{cols:"12"}},[t("SwitchField",{attrs:{label:e.$t("Запрашивать пол при регистрации"),hint:e.$t("Нужно ли запрашивать пол при регистрации нового счета ProBonus через бота"),secondHint:e.probonusSexRequired?e.$t("Опция обязательна в ProBonus. Для отключения измените настройки в ProBonus"):void 0,disabled:!e.model.bot_settings.register_user||e.probonusSexRequired},model:{value:e.model.bot_settings.need_sex,callback:function(t){e.$set(e.model.bot_settings,"need_sex",t)},expression:"model.bot_settings.need_sex"}})],1),t(d["a"],{staticClass:"pl-7",attrs:{cols:"12"}},[t("SwitchField",{attrs:{label:e.$t("Разрешить использовать имя и фамилию из Telegram"),hint:e.$t("Можно ли предоставить гостю при регистрации выбор между вводом имени и именем из Telegram"),disabled:!e.model.bot_settings.register_user},model:{value:e.model.bot_settings.allow_telegram_name,callback:function(t){e.$set(e.model.bot_settings,"allow_telegram_name",t)},expression:"model.bot_settings.allow_telegram_name"}})],1)],1),t("Panel",{attrs:{header:e.$t("Настройки подключения к ProBonus")}},[t(d["a"],{attrs:{cols:"12",md:"6"}},[t("TextField",{attrs:{label:e.$t("Логин"),hint:e.$t("Логин для подключения к серверу ProBonus"),rules:[function(t){return!!t||e.$t("Это поле обязательно")}]},model:{value:e.model.probonus_settings.login,callback:function(t){e.$set(e.model.probonus_settings,"login",t)},expression:"model.probonus_settings.login"}})],1),t(d["a"],{attrs:{cols:"12",md:"6"}},[t("PasswordField",{attrs:{label:e.$t("Пароль"),hint:e.$t("Пароль для подключения к серверу ProBonus"),rules:[function(t){return!!t||e.$t("Это поле обязательно")}]},model:{value:e.model.probonus_settings.password,callback:function(t){e.$set(e.model.probonus_settings,"password",t)},expression:"model.probonus_settings.password"}})],1),t(d["a"],{attrs:{cols:"12",md:"6"}},[t("TextField",{attrs:{label:e.$t("Адрес сервера"),hint:e.$t("Адрес, на котором стоит сервер ProBonus"),rules:[function(t){return!!t||e.$t("Это поле обязательно")},function(t){return!!t.match("^(?:(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(\\.(?!$)|$)){4}$")||!!t.match("^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]$")||e.$t("Адрес не валиден")}]},model:{value:e.model.probonus_settings.host,callback:function(t){e.$set(e.model.probonus_settings,"host",t)},expression:"model.probonus_settings.host"}})],1),t(d["a"],{attrs:{cols:"12",md:"6"}},[t("TextField",{attrs:{label:e.$t("Порт сервера"),hint:e.$t("Порт, который слушает сервер ProBonus"),rules:[function(t){return!!t||e.$t("Это поле обязательно")},function(t){return t=parseInt(t),t>=0&&t<=65535||e.$t("Доступны значения от 0 до 65535")}]},model:{value:e.model.probonus_settings.port,callback:function(t){e.$set(e.model.probonus_settings,"port",t)},expression:"model.probonus_settings.port"}})],1),t(d["a"],{attrs:{cols:"12",md:"6"}},[t("SelectField",{attrs:{label:e.$t("Стандартная группа счетов для регистрации гостей"),hint:e.$t("Стандартная группа счетов для самостоятельно зарегистрировавшихся из бота гостей"),items:e.accountGroupsWithTemplate,itemValue:"id",itemText:"name",noDataText:e.$t("В ProBonus нет подходящих групп с шаблоном"),rules:[function(t){return!!t&&e.accountGroupsWithTemplateIds.includes(t)||e.$t("Это поле обязательно")}]},model:{value:e.model.probonus_settings.group_id,callback:function(t){e.$set(e.model.probonus_settings,"group_id",t)},expression:"model.probonus_settings.group_id"}})],1),t(d["a"],{attrs:{cols:"12",md:"6"}},[t("TextField",{attrs:{disabled:!0,copy:!0,value:e.botUsername?"https://t.me/".concat(e.botUsername,"/"):e.$t("Здесь будет ссылка на бота в Telegram")}})],1),t(c["a"],{staticClass:"col-12",attrs:{outlined:""}},[t(u["c"],[t(d["a"],{attrs:{cols:"12"}},[t("T",[e._v("Добавить UTM-Метку")]),t(i["a"],{attrs:{icon:""},on:{click:function(t){return e.model.probonus_settings.utm_settings.push({utm:void 0,group_id:void 0})}}},[t(m["a"],{attrs:{size:"44",color:"green"}},[e._v("mdi-plus-circle")])],1)],1)],1),t(u["b"],e._l(e.model.probonus_settings.utm_settings,(function(s,n){return t(b["a"],{key:n},[t(d["a"],{staticClass:"pa-1",attrs:{cols:"12",md:"3"}},[t("TextField",{attrs:{label:e.$t("UTM-Метка"),hint:e.$t("UTM-Метка"),rules:[function(t){return!!t||e.$t("Это поле обязательно")},function(t){return!t.includes(" ")||e.$t("UTM-Метка не должна содержать пробелов")}]},model:{value:s.utm,callback:function(t){e.$set(s,"utm",t)},expression:"utm.utm"}})],1),t(d["a"],{staticClass:"pa-1",attrs:{cols:"12",md:"4"}},[t("SelectField",{attrs:{label:e.$t("Группа счетов"),hint:e.$t("Группа, в которой будет создан счет для пользователя зашедшего в бота по данной ссылке"),items:e.accountGroupsWithTemplate,itemValue:"id",itemText:"name",noDataText:e.$t("В ProBonus нет подходящих групп с шаблоном"),rules:[function(t){return!!t&&e.accountGroupsWithTemplateIds.includes(t)||e.$t("Это поле обязательно")}]},model:{value:s.group_id,callback:function(t){e.$set(s,"group_id",t)},expression:"utm.group_id"}})],1),t(d["a"],{staticClass:"pa-1",attrs:{cols:"11",md:"4"}},[t("TextField",{attrs:{disabled:!0,copy:!0,value:e.botUsername?"https://t.me/".concat(e.botUsername,"?start=").concat(s.utm):e.$t("Здесь будет ссылка на бота в Telegram")}})],1),t(d["a"],{staticClass:"pa-1",attrs:{cols:"1"}},[t(i["a"],{attrs:{icon:""}},[t(m["a"],{attrs:{size:"26",color:"red"},on:{click:function(t){return e.model.probonus_settings.utm_settings.splice(n,1)}}},[e._v(" mdi-trash-can ")])],1)],1)],1)})),1)],1)],1),t("Panel",{attrs:{header:e.$t("Отладочные настройки")}},[t(d["a"],{attrs:{cols:"12",md:"6"}},[t("SelectField",{attrs:{label:e.$t("Уровень логирования"),hint:e.$t("Уровень логирования. Чем больше цифра, тем подробнее лог"),items:e.logs,rules:[function(t){return!!t||0===parseInt(t)||e.$t("Это поле обязательно")}]},model:{value:e.model.debug_settings.level,callback:function(t){e.$set(e.model.debug_settings,"level",t)},expression:"model.debug_settings.level"}})],1),t(d["a"],{attrs:{cols:"12",md:"6"}},[t("TextField",{attrs:{label:e.$t("Срок хранения логов"),hint:e.$t("Срок хранения .log файлов (дней)"),rules:[function(t){return!!t||e.$t("Это поле обязательно")},function(t){return parseInt(t)>=1||e.$t("Срок хранения должен быть от 1-го дня")}]},model:{value:e.model.debug_settings.retention_days,callback:function(t){e.$set(e.model.debug_settings,"retention_days",t)},expression:"model.debug_settings.retention_days"}})],1),t(d["a"],{attrs:{cols:"12",md:"6"}},[t("TextField",{attrs:{label:e.$t("Размер тредпула сервера"),hint:e.$t("Максимальное количество открываемых потоков для обработки входящих запросов сервером"),rules:[function(t){return!!t||e.$t("Это поле обязательно")},function(t){return!!parseInt(t)||e.$t("Значение должно быть числом")}]},model:{value:e.model.debug_settings.threadpool_size,callback:function(t){e.$set(e.model.debug_settings,"threadpool_size",t)},expression:"model.debug_settings.threadpool_size"}})],1),t(d["a"],{attrs:{cols:"12",md:"6"}},[t("TextField",{attrs:{label:e.$t("Размер тредпула бота"),hint:e.$t("Максимальное количество открываемых потоков для обработки входящих запросов ботом"),rules:[function(t){return!!t||e.$t("Это поле обязательно")},function(t){return!!parseInt(t)||e.$t("Значение должно быть числом")}]},model:{value:e.model.debug_settings.bot_threadpool_size,callback:function(t){e.$set(e.model.debug_settings,"bot_threadpool_size",t)},expression:"model.debug_settings.bot_threadpool_size"}})],1)],1)],1)],1),t(u["a"],[t(f["a"]),t(i["a"],{attrs:{type:"submit",color:"primary",disabled:!e.formIsValid}},[t("T",[e._v("Сохранить")])],1)],1)],1),t(_["a"],{attrs:{value:e.snackbarMessage,dark:""}},[t(m["a"],[e._v("mdi-alert-circle-outline")]),e._v(" "+e._s(e.snackbarMessage)+" ")],1)],1)}),$=[],v=(s("4de4"),s("d3b7"),s("d81d"),s("037e")),k=s("763f"),x=s("d431"),T=s("149a"),w=s("b746"),C=s("8654"),F=function(){var e=this,t=e._self._c;return t(C["a"],e._g({attrs:{dense:"",outlined:"",filled:"",type:e.showPassword?"":"password","append-icon":e.showPassword?"mdi-eye-off":"mdi-eye",label:e.label,disabled:e.disabled,readonly:e.readonly,rules:e.rules},on:{"click:append":function(t){e.showPassword=!e.showPassword}},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("ToolTip",{attrs:{hint:e.hint}})]},proxy:!0},{key:"label",fn:function(){return[e._t("label")]},proxy:!0}],null,!0),model:{value:e.model,callback:function(t){e.model=t},expression:"model"}},e.$listeners))},I=[],y=s("10a3"),P={components:{ToolTip:y["a"]},data:function(){return{showPassword:!1}},computed:{model:{get:function(){return this.value},set:function(e){this.$emit("input",e)}}},props:["value","label","hint","disabled","readonly","rules"]},S=P,B=s("2877"),z=Object(B["a"])(S,F,I,!1,null,null,null),O=z.exports,U={components:{ExpansionPanels:v["a"],Panel:k["a"],TextField:x["a"],SwitchField:T["a"],SelectField:w["a"],PasswordField:O},props:["loading","value","localesList","accountGroupsList","probonusSexRequired","tokenIsValid","snackbarMessage","checkingToken","botUsername"],emits:["onSave","onTokenCheck","onTokenChange","input"],data:function(){return{openedPanels:[0,1,2,3],formIsValid:void 0,logs:[{value:0,text:"CRITICAL - 0"},{value:1,text:"ERROR - 1"},{value:2,text:"WARNING - 2"},{value:3,text:"SUCCESS - 3"},{value:5,text:"INFO - 5"},{value:8,text:"DEBUG - 8"},{value:10,text:"TRACE - 10"}]}},computed:{model:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},listenAll:{get:function(){return"0.0.0.0"===this.model.server_settings.host},set:function(e){this.model.server_settings.host=e?"0.0.0.0":""}},accountGroupsWithTemplate:function(){return this.accountGroupsList.filter((function(e){return e.haveTemplate}))},accountGroupsWithTemplateIds:function(){return this.accountGroupsWithTemplate.map((function(e){return e.id}))}}},L=U,M=Object(B["a"])(L,h,$,!1,null,null,null),V=M.exports,j=s("a08a"),G={components:{Fragment:r["a"],LoadingOverlay:j["a"],MainSettingsForm:V},data:function(){return{loading:!0,checkingToken:!1,localConfig:{},localesList:void 0,botUsername:void 0,probonusInfo:{account_groups:void 0,probonus_application_settings:{requireSex:void 0}},tokenIsValid:!1,snackbarMessage:void 0}},methods:{save:function(){var e=this;return Object(l["a"])(Object(a["a"])().mark((function t(){var s,n;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,n=e.localConfig.server_settings.host!=e.$store.getters.config.server_settings.host||e.localConfig.server_settings.port!=e.$store.getters.config.server_settings.port||e.localConfig.bot_settings.token!=e.$store.getters.config.bot_settings.token||e.localConfig.bot_settings.allow_reviews!=e.$store.getters.config.bot_settings.allow_reviews||e.localConfig.debug_settings.threadpool_size!=e.$store.getters.config.debug_settings.threadpool_size||e.localConfig.debug_settings.bot_threadpool_size!=e.$store.getters.config.debug_settings.bot_threadpool_size,t.next=4,e.$store.dispatch("putConfig",e.localConfig);case 4:if(e.$store.getters.locale_metadata.Language===(null===(s=e.$store.getters.config.server_settings)||void 0===s?void 0:s.language)){t.next=7;break}return t.next=7,e.$store.dispatch("getLocale");case 7:return t.prev=7,t.next=10,e.$store.dispatch("getBotInfoByApiToken",e.localConfig.bot_settings.token);case 10:e.botUsername=t.sent.username,t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](7),e.botUsername=void 0;case 16:n&&(e.snackbarMessage=e.$t("Для применения всех настроек требуется перезапуск службы"),setTimeout((function(){return e.snackbarMessage=void 0}),6e3)),e.loading=!1;case 18:case"end":return t.stop()}}),t,null,[[7,13]])})))()},checkToken:function(){var e=this;return Object(l["a"])(Object(a["a"])().mark((function t(){var s;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.checkingToken=!0,t.prev=1,t.next=4,e.$store.dispatch("getBotInfoByApiToken",e.localConfig.bot_settings.token);case 4:s=t.sent,s&&(e.tokenIsValid=!0,e.snackbarMessage=e.$t("Проверка пройдена успешно")),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),e.snackbarMessage=e.$t("Проверка не пройдена");case 11:e.checkingToken=!1,setTimeout((function(){return e.snackbarMessage=void 0}),4e3);case 13:case"end":return t.stop()}}),t,null,[[1,8]])})))()}},mounted:function(){var e=this;return Object(l["a"])(Object(a["a"])().mark((function t(){return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return document.title=e.$t("Настройки"),t.next=3,e.$store.dispatch("getConfig");case 3:return e.localConfig=JSON.parse(JSON.stringify(e.$store.getters.config)),t.next=6,e.$store.dispatch("getLocalesList");case 6:if(e.localesList=t.sent,e.localesList){t.next=9;break}return t.abrupt("return");case 9:return t.next=11,e.$store.dispatch("getProbonusInfo");case 11:if(e.probonusInfo=t.sent,e.probonusInfo.probonus_application_settings.requireSex&&(e.localConfig.bot_settings.need_sex=!0),!e.localConfig.bot_settings.token){t.next=23;break}return t.prev=14,t.next=17,e.$store.dispatch("getBotInfoByApiToken",e.localConfig.bot_settings.token);case 17:e.botUsername=t.sent.username,t.next=23;break;case 20:t.prev=20,t.t0=t["catch"](14),e.botUsername=void 0;case 23:e.loading=!1;case 24:case"end":return t.stop()}}),t,null,[[14,20]])})))()}},A=G,R=Object(B["a"])(A,n,o,!1,null,null,null);t["default"]=R.exports}}]);
//# sourceMappingURL=chunk-2d21abe6.df6ad9e0.js.map